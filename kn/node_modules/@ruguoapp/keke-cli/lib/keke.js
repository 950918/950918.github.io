#!/usr/bin/env node
const program = require('commander')
const pkg = require('../package.json')
const authRequest = require('./authRequest')
const updateNotifier = require('update-notifier')
const { readCredentials } = require('./utils')

require('./surge')
require('./login')
require('./upload')
require('./publish')
require('./release')
require('./history')
require('./qrcode')
require('./meow')

updateNotifier({ pkg, shouldNotifyInNpmScript: true, updateCheckInterval: 0 }).notify()

async function main () {
  program.version(pkg.version)
  try {
    const credentials = readCredentials()
    credentials.default && authRequest.interceptors.request.use((config) => {
      config.params = config.params || {}
      config.params['jtoken'] = credentials.default
      return config
    })
    program.parse(process.argv)
    // if (program.args.length < 1) {
    //   program.outputHelp()
    // }
  } catch (err) {
    console.error(err)
  }
}

main()
