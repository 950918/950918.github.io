# keke🐱 - 前端命令行工具

[![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)

## 先前步骤

在`.npmrc`或`.yarnrc`中设置即刻registry`https://npm.midway.run`

## 安装

全局安装： `npm -g install @ruguoapp/keke-cli` or `yarn global add @ruguoapp/keke-cli`

或仅作为项目开发依赖安装：`npm install @ruguoapp/keke-cli --save-dev` or `yarn add @ruguoapp/keke-cli -D`

或使用homebrew安装全局命令[WIP]

## 添加到scripts

开发中建议直接添加到`package.json`的`scripts`实现自动化发布，示例如下：

``` json
 "scripts": {
    ...
    "surge": "npm run build && keke surge",
    "surge:prod": "npm run build && keke surge --prod",
  }
```

## 使用

```bash
$ keke -h
Usage: keke [options] [command]

Options:
  -V, --version                      output the version number
  -h, --help                         output usage information

Commands:
  login                              登录authcenter，请根据提示操作。
  upload [options] <source>          将文件/文件夹上传到OSS
  publish [options] <source> [name]  将项目快照上传到服务器。使用source选项指定要上传的目录，name为项目名，如果不填写将使用当前工作目录下package.json里的name配置。
  release [options] [name]           将项目快照发布到线上环境。name为项目名，如果不填写将使用当前工作目录下package.json里的name配置。
  history [options] [name]           查看项目的发布历史。name为项目名，如果不填写将使用package.json里的name配置。
  qrcode [options] <msg>             在终端显示内容为<msg>的二维码。
  meow                               看看科科
```

## 命令

### login

使用login命令来登录auth center账号，如果token过期可能需要重新登录。目前只支持验证码登录。

使用方法：
``` bash
$ keke login
```


### surge

使用方法：
``` bash
$ keke surge
Usage: surge [options] [source]

使用surge命令来进行一键上传发版，surge命令会依次执行upload，publish，release三个步骤。第一次运行surge命令将会有一个交互式命令行来帮助你生成一些配置。

Options:
  -n, --name [codename]          项目名
  -g, --group [group]            项目组名
  --prod [boolean]               发布到prod环境，如果不开启此项配置将默认发布到beta环境
  -p, --prefix [prefix]          上传到OSS的前缀，会自动生成。如果你不了解怎么写可以留空。
  -c, --concurrent [concurrent]  the number of concurrent upload.
  --allow-sourcemap [boolean]    allow sourcemap uploading.
  -h, --help                     output usage information

```

### upload

``` bash
$ keke upload -h
Usage: upload [options] <source>

将文件/文件夹上传到OSS

Options:
  -p, --prefix [prefix]          项目名，必填
  -c, --concurrent [concurrent]  the number of concurrent upload.
  --allow-sourcemap [boolean]    allow sourcemap uploading.
  -h, --help                     output usage information
```

示例：
``` bash
// 将dist目录里的所有文件上传到https://static.codefuture.top/mobile-site/
keke upload ./dist -n mobile-site
```
<img src="doc/images/upload-success.png" width="600px"/>

在上传时keke会将png或jpeg文件压缩后上传，不过仍然可以通过在文件末尾加`.raw`来访问未经压缩的原图。

### publish

``` bash
$ keke publish -h
Usage: publish [options] <source>

将项目快照上传到服务器。使用source选项指定要上传的目录，name为项目名，如果不填写将使用当前工作目录下package.json里的name配置。

Options:
  -p, --prefix [prefix]        项目所在分组。
  -n, --name [codename]        项目所在分组。
  -g, --group [group]          项目所在分组。
  --allow-sourcemap [boolean]  是否允许上传.map文件，默认禁止上传。
  -h, --help                   output usage information
```
<img src="doc/images/keke-publish.png" width="600px"/>

### release

``` bash
$ keke release -h
Usage: release [options]

将项目快照发布到线上环境。name为项目名

Options:
  -n, --name [codename]  项目名
  -g, --group [group]    项目所在分组
  --prod [boolean]       发布到prod环境，如果不开启此项配置将默认发布到beta环境
  --hash [hash]          使用history命令查询版本发布历史，填写快照hash用来快速回滚，留空以发布最新的版本。
  -h, --help             output usage information
```

示例：
``` bash
$ keke release fe-test2 --hash f863c2c17980f0b42469f3a15e557f90 -e prod
```
<img src="doc/images/keke-release.png" width="600px"/>


### history

``` bash
$ keke history -h
Usage: history [options]

查看项目的发布历史。name为项目名，如果不填写将使用package.json里的name配置。

Options:
  -n, --name [codename]  项目名
  -g, --group [group]    项目所在分组
  -l --limit [limit]     查询数目限制。
  -h, --help             output usage information
```

示例：
``` bash
$ keke history test-mingxin -l 10
```

## keke是谁

``` bash
$ keke meow
```
<img src="doc/images/keke-meow.png" width="600px"/>

> 科科爱你哟❤️
<!-- <img src="doc/images/keke-rabbit.jpeg" width="300px"/> -->
